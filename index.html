<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Doxify</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: Arial, sans-serif;
        }

        body {
            background-color: #000;
            color: #fff;
            line-height: 1.4;
            font-size: 14px;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            border-bottom: 1px solid #333;
            padding: 10px 0;
            margin-bottom: 20px;
        }

        .logo {
            font-size: 24px;
            font-weight: bold;
            color: #fff;
            text-decoration: none;
        }

        nav {
            margin-top: 10px;
        }

        nav a {
            color: #ccc;
            text-decoration: none;
            margin-right: 15px;
        }

        nav a:hover {
            color: #fff;
        }

        .search-box {
            margin: 20px 0;
        }

        .search-box input {
            width: 300px;
            padding: 8px;
            background: #111;
            border: 1px solid #333;
            color: #fff;
        }

        .search-box button {
            padding: 8px 15px;
            background: #333;
            border: 1px solid #333;
            color: #fff;
            cursor: pointer;
        }

        .btn {
            display: inline-block;
            padding: 8px 15px;
            background: #333;
            color: #fff;
            text-decoration: none;
            border: 1px solid #333;
            margin: 10px 0;
            cursor: pointer;
        }

        .btn:hover {
            background: #444;
        }

        .btn:disabled {
            background: #222;
            color: #666;
            cursor: not-allowed;
        }

        .page-list {
            margin: 20px 0;
        }

        .page-item {
            border: 1px solid #333;
            padding: 15px;
            margin-bottom: 10px;
            background: #111;
        }

        .page-title {
            font-weight: bold;
            margin-bottom: 5px;
        }

        .page-id {
            color: #888;
            font-size: 12px;
            margin-bottom: 8px;
        }

        .page-preview {
            color: #ccc;
            margin-bottom: 10px;
            font-size: 13px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            color: #ccc;
        }

        .form-group input,
        .form-group textarea {
            width: 100%;
            padding: 8px;
            background: #111;
            border: 1px solid #333;
            color: #fff;
        }

        .form-group textarea {
            height: 300px;
            resize: vertical;
        }

        .page-content {
            white-space: pre-wrap;
            background: #111;
            padding: 20px;
            border: 1px solid #333;
            margin: 20px 0;
        }

        .url-preview {
            background: #111;
            padding: 10px;
            border: 1px solid #333;
            margin: 10px 0;
            font-family: monospace;
            color: #0f0;
        }

        .error {
            color: #f00;
            margin: 5px 0;
            font-size: 12px;
        }

        .success {
            color: #0f0;
            margin: 5px 0;
            font-size: 12px;
        }

        footer {
            border-top: 1px solid #333;
            padding: 20px 0;
            margin-top: 40px;
            color: #888;
            font-size: 12px;
        }

        .page {
            display: none;
        }

        .page.active {
            display: block;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <a href="#" class="logo">DOXIFY</a>
            <nav>
                <a href="#" id="home-link">Home</a>
                <a href="#" id="write-link">Write Dox</a>
                <a href="#" id="browse-link">Browse</a>
            </nav>
        </header>

        <!-- Home Page -->
        <div id="home-page" class="page active">
            <div class="search-box">
                <input type="text" id="search-input" placeholder="Search posts...">
                <button id="search-button">Search</button>
            </div>
            
            <a href="#" class="btn" id="write-dox-btn">Write Dox</a>

            <div class="page-list" id="recent-pages">
                <!-- Recent pages will appear here -->
            </div>
        </div>

        <!-- Write Page -->
        <div id="write-page" class="page">
            <h2>Create New Dox</h2>
            <form id="dox-form">
                <div class="form-group">
                    <label for="page-slug">Page URL (https://doxify.cc/<span id="slug-preview">your-page-name</span>)</label>
                    <input type="text" id="page-slug" required placeholder="Enter page URL name (letters, numbers, hyphens only)">
                    <div id="slug-error" class="error"></div>
                    <div id="slug-success" class="success"></div>
                </div>
                <div class="form-group">
                    <label for="page-title">Title</label>
                    <input type="text" id="page-title" required>
                </div>
                <div class="form-group">
                    <label for="page-content">Content</label>
                    <textarea id="page-content" required></textarea>
                </div>
                <div class="url-preview" id="url-preview">
                    URL: https://doxify.cc/<span id="final-slug">your-page-name</span>
                </div>
                <button type="submit" class="btn" id="submit-btn" disabled>Create Page</button>
            </form>
        </div>

        <!-- Browse Page -->
        <div id="browse-page" class="page">
            <h2>All Pages</h2>
            <div class="page-list" id="all-pages">
                <!-- All pages will appear here -->
            </div>
        </div>

        <!-- View Page -->
        <div id="view-page" class="page">
            <div id="page-content-container">
                <!-- Page content will appear here -->
            </div>
        </div>

        <footer>
            Doxify - Anonymous text sharing platform
        </footer>
        <h5>administration - @skyhf</h5>
    </div>

    <script>
        // Database simulation using localStorage
        const DB_KEY = 'doxify_pages';
        
        // Initialize database if it doesn't exist
        function initDatabase() {
            if (!localStorage.getItem(DB_KEY)) {
                localStorage.setItem(DB_KEY, JSON.stringify([]));
            }
        }
        
        // Get all pages from database
        function getAllPages() {
            return JSON.parse(localStorage.getItem(DB_KEY) || '[]');
        }
        
        // Check if slug already exists
        function slugExists(slug) {
            const pages = getAllPages();
            return pages.some(page => page.slug === slug.toLowerCase());
        }
        
        // Validate slug format
        function isValidSlug(slug) {
            return /^[a-zA-Z0-9-]+$/.test(slug) && slug.length >= 3 && slug.length <= 50;
        }
        
        // Save a new page to database
        function savePage(slug, title, content) {
            const pages = getAllPages();
            const newPage = {
                slug: slug.toLowerCase(),
                title: title,
                content: content,
                createdAt: new Date().toISOString()
            };
            
            pages.push(newPage);
            localStorage.setItem(DB_KEY, JSON.stringify(pages));
            return newPage;
        }
        
        // Get a page by slug
        function getPageBySlug(slug) {
            const pages = getAllPages();
            return pages.find(page => page.slug === slug.toLowerCase());
        }
        
        // Search pages by keyword
        function searchPages(keyword) {
            const pages = getAllPages();
            const lowerKeyword = keyword.toLowerCase();
            return pages.filter(page => 
                page.title.toLowerCase().includes(lowerKeyword) || 
                page.content.toLowerCase().includes(lowerKeyword) ||
                page.slug.toLowerCase().includes(lowerKeyword)
            );
        }
        
        // Navigation functions
        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            document.getElementById(pageId).classList.add('active');
        }
        
        function showHomePage() {
            showPage('home-page');
            displayRecentPages();
        }
        
        function showWritePage() {
            showPage('write-page');
            document.getElementById('page-slug').value = '';
            document.getElementById('page-title').value = '';
            document.getElementById('page-content').value = '';
            document.getElementById('slug-error').textContent = '';
            document.getElementById('slug-success').textContent = '';
            document.getElementById('submit-btn').disabled = true;
            updateSlugPreview();
        }
        
        function showBrowsePage() {
            showPage('browse-page');
            displayAllPages();
        }
        
        function showViewPage(slug) {
            showPage('view-page');
            displayPageContent(slug);
        }
        
        // Update slug preview
        function updateSlugPreview() {
            const slugInput = document.getElementById('page-slug');
            const slugPreview = document.getElementById('slug-preview');
            const finalSlug = document.getElementById('final-slug');
            const errorDiv = document.getElementById('slug-error');
            const successDiv = document.getElementById('slug-success');
            const submitBtn = document.getElementById('submit-btn');
            
            let slug = slugInput.value.trim().toLowerCase();
            
            if (slug === '') {
                slugPreview.textContent = 'your-page-name';
                finalSlug.textContent = 'your-page-name';
                errorDiv.textContent = '';
                successDiv.textContent = '';
                submitBtn.disabled = true;
                return;
            }
            
            // Clean the slug
            slug = slug.replace(/[^a-zA-Z0-9-]/g, '-').replace(/-+/g, '-').replace(/^-|-$/g, '');
            
            slugPreview.textContent = slug;
            finalSlug.textContent = slug;
            
            if (!isValidSlug(slug)) {
                errorDiv.textContent = 'URL name can only contain letters, numbers, and hyphens (3-50 characters)';
                successDiv.textContent = '';
                submitBtn.disabled = true;
            } else if (slugExists(slug)) {
                errorDiv.textContent = 'This URL name is already taken. Please choose a different one.';
                successDiv.textContent = '';
                submitBtn.disabled = true;
            } else {
                errorDiv.textContent = '';
                successDiv.textContent = 'URL name is available!';
                submitBtn.disabled = false;
            }
        }
        
        // Display functions
        function displayRecentPages() {
            const pages = getAllPages().slice(-10).reverse();
            const container = document.getElementById('recent-pages');
            container.innerHTML = '';
            
            if (pages.length === 0) {
                container.innerHTML = '<p>No pages yet.</p>';
                return;
            }
            
            pages.forEach(page => {
                const preview = page.content.length > 200 ? page.content.substring(0, 200) + '...' : page.content;
                const pageElement = document.createElement('div');
                pageElement.className = 'page-item';
                pageElement.innerHTML = `
                    <div class="page-title">${page.title}</div>
                    <div class="page-id">/${page.slug}</div>
                    <div class="page-preview">${preview}</div>
                    <a href="#" class="view-page-link" data-slug="${page.slug}">View</a>
                `;
                container.appendChild(pageElement);
            });
            
            // Add event listeners to view page links
            document.querySelectorAll('.view-page-link').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    showViewPage(this.getAttribute('data-slug'));
                });
            });
        }
        
        function displayAllPages() {
            const pages = getAllPages().reverse();
            const container = document.getElementById('all-pages');
            container.innerHTML = '';
            
            if (pages.length === 0) {
                container.innerHTML = '<p>No pages yet.</p>';
                return;
            }
            
            pages.forEach(page => {
                const preview = page.content.length > 200 ? page.content.substring(0, 200) + '...' : page.content;
                const pageElement = document.createElement('div');
                pageElement.className = 'page-item';
                pageElement.innerHTML = `
                    <div class="page-title">${page.title}</div>
                    <div class="page-id">/${page.slug}</div>
                    <div class="page-preview">${preview}</div>
                    <a href="#" class="view-page-link" data-slug="${page.slug}">View</a>
                `;
                container.appendChild(pageElement);
            });
            
            // Add event listeners to view page links
            document.querySelectorAll('.view-page-link').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    showViewPage(this.getAttribute('data-slug'));
                });
            });
        }
        
        function displayPageContent(slug) {
            const page = getPageBySlug(slug);
            const container = document.getElementById('page-content-container');
            
            if (!page) {
                container.innerHTML = '<p>Page not found.</p>';
                return;
            }
            
            const date = new Date(page.createdAt).toLocaleDateString();
            container.innerHTML = `
                <h2>${page.title}</h2>
                <div style="color: #888; margin: 10px 0;">/${page.slug} | ${date}</div>
                <div class="page-content">${page.content}</div>
                <div style="margin: 20px 0; padding: 10px; background: #111; border: 1px solid #333;">
                    <strong>Page URL:</strong> https://doxify.cc/${page.slug}
                </div>
                <a href="#" class="btn" id="back-to-browse">Back to Browse</a>
            `;
            
            document.getElementById('back-to-browse').addEventListener('click', function(e) {
                e.preventDefault();
                showBrowsePage();
            });
        }
        
        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize database
            initDatabase();
            
            // Set up navigation
            document.getElementById('home-link').addEventListener('click', function(e) {
                e.preventDefault();
                showHomePage();
            });
            
            document.getElementById('write-link').addEventListener('click', function(e) {
                e.preventDefault();
                showWritePage();
            });
            
            document.getElementById('browse-link').addEventListener('click', function(e) {
                e.preventDefault();
                showBrowsePage();
            });
            
            document.getElementById('write-dox-btn').addEventListener('click', function(e) {
                e.preventDefault();
                showWritePage();
            });
            
            // Set up slug validation
            document.getElementById('page-slug').addEventListener('input', updateSlugPreview);
            
            // Set up form submission
            document.getElementById('dox-form').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const slug = document.getElementById('page-slug').value.trim().toLowerCase();
                const title = document.getElementById('page-title').value;
                const content = document.getElementById('page-content').value;
                
                if (!isValidSlug(slug)) {
                    alert('Please enter a valid URL name (letters, numbers, and hyphens only, 3-50 characters)');
                    return;
                }
                
                if (slugExists(slug)) {
                    alert('This URL name is already taken. Please choose a different one.');
                    return;
                }
                
                if (title.trim() === '' || content.trim() === '') {
                    alert('Please fill in both title and content.');
                    return;
                }
                
                const newPage = savePage(slug, title, content);
                showViewPage(newPage.slug);
                
                // Update URL in browser (without reloading)
                window.history.pushState({}, '', `/${newPage.slug}`);
            });
            
            // Set up search
            document.getElementById('search-button').addEventListener('click', function() {
                const keyword = document.getElementById('search-input').value.trim();
                
                if (keyword === '') {
                    showBrowsePage();
                    return;
                }
                
                const results = searchPages(keyword);
                const container = document.getElementById('all-pages');
                container.innerHTML = '';
                
                if (results.length === 0) {
                    container.innerHTML = '<p>No results found.</p>';
                    return;
                }
                
                results.forEach(page => {
                    const preview = page.content.length > 200 ? page.content.substring(0, 200) + '...' : page.content;
                    const pageElement = document.createElement('div');
                    pageElement.className = 'page-item';
                    pageElement.innerHTML = `
                        <div class="page-title">${page.title}</div>
                        <div class="page-id">/${page.slug}</div>
                        <div class="page-preview">${preview}</div>
                        <a href="#" class="view-page-link" data-slug="${page.slug}">View</a>
                    `;
                    container.appendChild(pageElement);
                });
                
                // Add event listeners to view page links
                document.querySelectorAll('.view-page-link').forEach(link => {
                    link.addEventListener('click', function(e) {
                        e.preventDefault();
                        showViewPage(this.getAttribute('data-slug'));
                    });
                });
                
                showBrowsePage();
            });
            
            // Handle direct URL access
            function handleDirectAccess() {
                const path = window.location.pathname.substring(1); // Remove leading slash
                if (path && path !== '') {
                    const page = getPageBySlug(path);
                    if (page) {
                        showViewPage(path);
                    } else {
                        showHomePage();
                    }
                } else {
                    showHomePage();
                }
            }
            
            // Listen for URL changes
            window.addEventListener('popstate', handleDirectAccess);
            
            // Check initial URL
            handleDirectAccess();
            
            // Display recent pages on home page
            displayRecentPages();
        });
    </script>
</body>
</html>
